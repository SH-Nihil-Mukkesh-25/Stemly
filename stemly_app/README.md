# Stemly Flutter App

Cross-platform mobile app for AI-powered STEM learning. Scan problems, visualize physics, generate quizzes, and chat with an AI tutor.

## Prerequisites

| Tool | Version | Installation |
|------|---------|-------------|
| Flutter SDK | 3.x+ (Dart 3.10.1+) | [flutter.dev/get-started](https://docs.flutter.dev/get-started/install) |
| Android Studio | latest | [developer.android.com](https://developer.android.com/studio) |
| Xcode (macOS only) | 15+ | Mac App Store |
| Firebase project | — | [Firebase Console](https://console.firebase.google.com/) |

Verify your setup:

```bash
flutter doctor
```

All checks should pass for your target platform(s).

## Installation

```bash
# From the repository root
cd stemly_app

# Install dependencies
flutter pub get
```

## Firebase Setup

Firebase is required for authentication, analytics, and cloud features. See [FIREBASE_SETUP.md](FIREBASE_SETUP.md) for the full guide.

Quick version:

```bash
# Install FlutterFire CLI
dart pub global activate flutterfire_cli

# Configure Firebase (generates firebase_options.dart)
flutterfire configure

# For Android: add SHA keys to Firebase Console
cd android && ./gradlew signingReport
```

Required files after setup:
- `lib/firebase_options.dart` — generated by FlutterFire CLI
- `android/app/google-services.json` — downloaded from Firebase Console
- `ios/Runner/GoogleService-Info.plist` — downloaded from Firebase Console (iOS only)

## Running the App

### Android

```bash
# Start an emulator (or connect a physical device)
flutter emulators --launch <emulator_id>

# Run the app
flutter run
```

To list available emulators: `flutter emulators`

### iOS (macOS only)

```bash
# Install CocoaPods dependencies
cd ios && pod install && cd ..

# Open the iOS simulator
open -a Simulator

# Run the app
flutter run
```

### Web

```bash
flutter run -d chrome
```

### Specifying a device

```bash
# List connected devices
flutter devices

# Run on a specific device
flutter run -d <device_id>
```

## Building

### Debug APK (Android)

```bash
flutter build apk --debug
# Output: build/app/outputs/flutter-apk/app-debug.apk
```

### Release APK (Android)

```bash
flutter build apk --release
# Output: build/app/outputs/flutter-apk/app-release.apk
```

### App Bundle (Android — for Play Store)

```bash
flutter build appbundle --release
# Output: build/app/outputs/bundle/release/app-release.aab
```

### iOS (requires macOS + Xcode)

```bash
flutter build ios --release
# Then archive and distribute via Xcode
```

## Running Tests

```bash
# Run all tests
flutter test

# Run with coverage
flutter test --coverage

# Run a specific test file
flutter test test/widget_test.dart
```

## Code Quality

```bash
# Analyze code for issues
flutter analyze

# Auto-format code
dart format .

# Check formatting without modifying
dart format --set-exit-if-changed .
```

## Project Structure

```
stemly_app/
├── lib/
│   ├── main.dart              # App entry point
│   ├── firebase_options.dart  # Firebase config (generated)
│   │
│   ├── screens/               # Full-page UI screens
│   ├── widgets/               # Reusable UI components
│   ├── models/                # Data models
│   ├── services/              # API and Firebase services
│   ├── visualiser/            # Physics simulation rendering
│   ├── quiz/                  # Quiz logic and UI
│   ├── storage/               # Local storage helpers
│   └── theme/                 # App theming
│
├── assets/
│   └── team/                  # Team member images
│
├── android/                   # Android platform code
├── ios/                       # iOS platform code
├── web/                       # Web platform code
├── windows/                   # Windows platform code
├── linux/                     # Linux platform code
├── macos/                     # macOS platform code
│
├── pubspec.yaml               # Dependencies
├── FIREBASE_SETUP.md          # Firebase configuration guide
└── build.sh                   # Build script
```

## Environment Configuration

The app connects to the backend API. To change the API URL, update the base URL in the service files under `lib/services/`.

For local development, ensure the backend is running at the expected address (see `../backend/README.md`).

## Troubleshooting

### `flutter pub get` fails

- Run `flutter doctor` and resolve any issues
- Delete `pubspec.lock` and retry: `rm pubspec.lock && flutter pub get`
- Clear the pub cache: `flutter pub cache clean`

### Google Sign-In shows "ApiException: 10"

This means Firebase is misconfigured. See [FIREBASE_SETUP.md](FIREBASE_SETUP.md) for the full fix:
1. Add SHA-1 and SHA-256 keys to Firebase Console
2. Download fresh `google-services.json`
3. Run `flutterfire configure`
4. Clean rebuild: `flutter clean && flutter pub get && flutter run`

### Build fails with Gradle errors (Android)

```bash
cd android
./gradlew clean
cd ..
flutter clean
flutter pub get
flutter run
```

### CocoaPods errors (iOS)

```bash
cd ios
rm -rf Pods Podfile.lock
pod install --repo-update
cd ..
flutter clean
flutter run
```

### App crashes on launch

- Check that `lib/firebase_options.dart` contains real values (not placeholders)
- Ensure the backend is running if features require API calls
- Check `flutter run` console output for detailed error messages
